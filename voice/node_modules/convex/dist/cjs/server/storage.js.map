{
  "version": 3,
  "sources": ["../../../src/server/storage.ts"],
  "sourcesContent": ["import { GenericId } from \"../values/index.js\";\n\n/**\n * A reference to a file in storage.\n *\n * This is used in the {@link StorageReader} and {@link StorageWriter} which are accessible in\n * Convex queries and mutations via {@link QueryCtx} and {@link MutationCtx} respectively.\n *\n * @public\n */\nexport type StorageId = string;\nexport type FileStorageId = GenericId<\"_storage\"> | StorageId;\n/**\n * Metadata for a single file as returned by {@link StorageReader.getMetadata | storage.getMetadata}.\n *\n * @public\n */\nexport type FileMetadata = {\n  /**\n   * ID for referencing the file (eg. via {@link StorageReader.getUrl | storage.getUrl})\n   */\n  storageId: StorageId;\n  /**\n   * Hex encoded sha256 checksum of file contents\n   */\n  sha256: string;\n  /**\n   * Size of the file in bytes\n   */\n  size: number;\n  /**\n   * ContentType of the file if it was provided on upload\n   */\n  contentType: string | null;\n};\n\n/**\n * An interface to read files from storage within Convex query functions.\n *\n * Available as `ctx.storage` in queries (read-only), mutations, and actions.\n *\n * @example\n * ```typescript\n * // Get a URL for a stored file:\n * const url = await ctx.storage.getUrl(storageId);\n * if (url) {\n *   // Use the URL (e.g., return it to the client)\n * }\n *\n * // Get file metadata via the system table (preferred over deprecated getMetadata):\n * const metadata = await ctx.db.system.get(\"_storage\", storageId);\n * // metadata: { _id, _creationTime, sha256, size, contentType? }\n * ```\n *\n * @see https://docs.convex.dev/file-storage\n * @public\n */\nexport interface StorageReader {\n  /**\n   * Get the URL for a file in storage by its `Id<\"_storage\">`.\n   *\n   * The GET response includes a standard HTTP Digest header with a sha256 checksum.\n   *\n   * @example\n   * ```typescript\n   * const url = await ctx.storage.getUrl(storageId);\n   * ```\n   *\n   * @param storageId - The `Id<\"_storage\">` of the file to fetch from Convex storage.\n   * @returns - A URL which fetches the file via an HTTP GET, or `null` if the file no longer exists.\n   */\n  getUrl(storageId: GenericId<\"_storage\">): Promise<string | null>;\n\n  /**\n   * @deprecated Passing a string is deprecated, use `storage.getUrl(Id<\"_storage\">)` instead.\n   *\n   * Get the URL for a file in storage by its {@link StorageId}.\n   *\n   * The GET response includes a standard HTTP Digest header with a sha256 checksum.\n   *\n   * @param storageId - The {@link StorageId} of the file to fetch from Convex storage.\n   * @returns - A url which fetches the file via an HTTP GET, or `null` if it no longer exists.\n   */\n  getUrl<T extends StorageId>(\n    storageId: T extends { __tableName: any } ? never : T,\n  ): Promise<string | null>;\n\n  /**\n   * @deprecated Use `ctx.db.system.get(\"_storage\", storageId)` instead, which returns\n   * equivalent metadata from the `_storage` system table (with a slightly different shape):\n   * ```typescript\n   * const metadata = await ctx.db.system.get(\"_storage\", storageId);\n   * // { _id, _creationTime, sha256, size, contentType? }\n   * ```\n   *\n   * Get metadata for a file.\n   *\n   * @param storageId - The `Id<\"_storage\">` of the file.\n   * @returns - A {@link FileMetadata} object if found or `null` if not found.\n   */\n  getMetadata(storageId: GenericId<\"_storage\">): Promise<FileMetadata | null>;\n\n  /**\n   * @deprecated Use `ctx.db.system.get(\"_storage\", storageId)` instead.\n   *\n   * Get metadata for a file.\n   *\n   * @param storageId - The {@link StorageId} of the file.\n   * @returns - A {@link FileMetadata} object if found or `null` if not found.\n   */\n  getMetadata<T extends StorageId>(\n    storageId: T extends { __tableName: any } ? never : T,\n  ): Promise<FileMetadata | null>;\n}\n\n/**\n * An interface to write files to storage within Convex mutation functions.\n *\n * Available as `ctx.storage` in mutations.\n *\n * @see https://docs.convex.dev/file-storage\n * @public\n */\nexport interface StorageWriter extends StorageReader {\n  /**\n   * Generate a short-lived URL for uploading a file into storage.\n   *\n   * The client should make a POST request to this URL with the file as the\n   * body. The response will be a JSON object containing a newly allocated\n   * `Id<\"_storage\">` (`{ storageId: \"...\" }`).\n   *\n   * @example\n   * ```typescript\n   * // In a mutation, generate the upload URL:\n   * export const generateUploadUrl = mutation({\n   *   args: {},\n   *   returns: v.string(),\n   *   handler: async (ctx) => {\n   *     return await ctx.storage.generateUploadUrl();\n   *   },\n   * });\n   *\n   * // On the client, upload the file:\n   * // const uploadUrl = await generateUploadUrl();\n   * // const result = await fetch(uploadUrl, { method: \"POST\", body: file });\n   * // const { storageId } = await result.json();\n   * ```\n   *\n   * @returns - A short-lived URL for uploading a file via HTTP POST.\n   */\n  generateUploadUrl(): Promise<string>;\n  /**\n   * Delete a file from Convex storage.\n   *\n   * Once a file is deleted, any URLs previously generated by {@link StorageReader.getUrl} will return 404s.\n   *\n   * @example\n   * ```typescript\n   * await ctx.storage.delete(storageId);\n   * ```\n   *\n   * @param storageId - The `Id<\"_storage\">` of the file to delete from Convex storage.\n   */\n  delete(storageId: GenericId<\"_storage\">): Promise<void>;\n\n  /**\n   * @deprecated Passing a string is deprecated, use `storage.delete(Id<\"_storage\">)` instead.\n   *\n   * Delete a file from Convex storage.\n   *\n   * Once a file is deleted, any URLs previously generated by {@link StorageReader.getUrl} will return 404s.\n   *\n   * @param storageId - The {@link StorageId} of the file to delete from Convex storage.\n   */\n  delete<T extends StorageId>(\n    storageId: T extends { __tableName: any } ? never : T,\n  ): Promise<void>;\n}\n\n/**\n * An interface to read and write files to storage within Convex actions and HTTP actions.\n *\n * In actions, `ctx.storage` has additional methods not available in mutations:\n * `get()` to download a file as a Blob, and `store()` to upload a Blob directly.\n *\n * @example\n * ```typescript\n * // In an action, download and re-upload a file:\n * const blob = await ctx.storage.get(storageId);\n * if (blob) {\n *   const newStorageId = await ctx.storage.store(blob);\n * }\n * ```\n *\n * @public\n */\nexport interface StorageActionWriter extends StorageWriter {\n  /**\n   * Download a file from storage as a Blob.\n   *\n   * Only available in actions and HTTP actions (not in mutations or queries).\n   *\n   * @param storageId - The `Id<\"_storage\">` of the file.\n   * @returns A Blob containing the file contents, or `null` if the file doesn't exist.\n   */\n  get(storageId: GenericId<\"_storage\">): Promise<Blob | null>;\n\n  /**\n   * @deprecated Passing a string is deprecated, use `storage.get(Id<\"_storage\">)` instead.\n   *\n   * Get a Blob containing the file associated with the provided {@link StorageId}, or `null` if there is no file.\n   */\n  get<T extends StorageId>(\n    storageId: T extends { __tableName: any } ? never : T,\n  ): Promise<Blob | null>;\n  /**\n   * Upload a Blob directly to storage.\n   *\n   * Only available in actions and HTTP actions. For client-side uploads from\n   * mutations, use `generateUploadUrl()` instead.\n   *\n   * @example\n   * ```typescript\n   * const storageId = await ctx.storage.store(blob);\n   * // Save storageId to the database via ctx.runMutation\n   * ```\n   *\n   * @param blob - The Blob to store.\n   * @param options - Optional settings. Pass `sha256` to verify the file integrity.\n   * @returns The `Id<\"_storage\">` of the newly stored file.\n   */\n  store(\n    blob: Blob,\n    options?: { sha256?: string },\n  ): Promise<GenericId<\"_storage\">>;\n}\n"],
  "mappings": ";;;;;;;;;;;;;;AAAA;AAAA;",
  "names": []
}
